{% assign current_url = page.url | default: "/" %}
{% assign current_slice = current_url | slice: 0, 4 %}
{% assign is_ja_path = false %}
{% if current_url == '/ja' or current_url == '/ja/' or current_slice == '/ja/' %}
  {% assign is_ja_path = true %}
{% endif %}
{% assign is_ja = false %}
{% if page.lang == 'ja' or is_ja_path %}
  {% assign is_ja = true %}
{% endif %}

{% assign en_switch = current_url %}
{% assign ja_switch = current_url %}
{% if is_ja_path %}
  {% if current_url == '/ja' or current_url == '/ja/' %}
    {% assign en_switch = '/' %}
  {% else %}
    {% assign en_switch = current_url | remove_first: '/ja' %}
  {% endif %}
  {% assign ja_switch = current_url %}
{% else %}
  {% assign en_switch = current_url %}
  {% if current_url == '/' %}
    {% assign ja_switch = '/ja/' %}
  {% else %}
    {% assign ja_switch = '/ja' | append: current_url %}
  {% endif %}
{% endif %}
{% if en_switch == '' %}
  {% assign en_switch = '/' %}
{% endif %}

<header class="top-nav">
  <div class="container nav-inner">
    {% if is_ja %}
      <a class="brand" href="{{ '/ja/' | relative_url }}">{{ site.data.site.site_title_ja }}</a>
    {% else %}
      <a class="brand" href="{{ "/" | relative_url }}">{{ site.data.site.site_title }}</a>
    {% endif %}
    <nav class="nav-links" aria-label="Primary">
      {% if is_ja %}
        <a class="nav-link {% if current_url == '/ja/' or current_url == '/ja' %}is-active{% endif %}" href="{{ '/ja/' | relative_url }}">ホーム</a>
        <a class="nav-link {% if current_url == '/ja/about/' %}is-active{% endif %}" href="{{ '/ja/about/' | relative_url }}">概要 / 連絡先</a>
      {% else %}
        <a class="nav-link {% if current_url == '/' %}is-active{% endif %}" href="{{ "/" | relative_url }}">Home</a>
        <a class="nav-link {% if current_url == '/about/' %}is-active{% endif %}" href="{{ "/about/" | relative_url }}">About / Contact</a>
      {% endif %}
    </nav>
    <div class="lang-toggle">
      {% if is_ja %}
        <a href="{{ en_switch | relative_url }}" data-lang-switch="en" class="active">EN</a>
        <span class="divider">|</span>
        <span class="current">日本語</span>
      {% else %}
        <span class="current">EN</span>
        <span class="divider">|</span>
        <a href="{{ ja_switch | relative_url }}" data-lang-switch="ja">日本語</a>
      {% endif %}
    </div>
  </div>
</header>
